@model  IEnumerable<SIMS_CW.Models.idea>

@using SIMS_CW.Models;

@{
    ViewBag.Title = "Statistics";
    Layout = "~/Views/Shared/_Layout.cshtml";

    DbModel dbData = new DbModel();
}


<div class="container">
    <div class="row">

        @foreach (department dept in dbData.departments.ToList())
        {
        <div class="col-lg-6">

            <h2> Statistical data for <small>@dept.department_name Department </small></h2>
            <br>
           
            

                <h4></h4>
                <table class="table table-hover table-striped table-condensed table-responsive">
                    <tr>
                        <td> Number of Ideas </td>
                        @{
            List<idea> ideaa = dbData.ideas.ToList();
            int total_ideas = ideaa.Where(i => i.user.department.department_id == dept.department_id).Count();

                <td style="text-align: right; "> @(total_ideas == 0 ? "0" : String.Format("{0:.#}", total_ideas))</td>
                <td></td>
                        }
                    </tr>

                    <tr>
                        <td>Precentage of Ideas</td>
                        @{

            List<idea> idea = dbData.ideas.ToList();
            int total_ideass = idea.Where(i => i.user.department.department_id == dept.department_id).Count();
            decimal percentage = (decimal.Divide(total_ideass, idea.Count())) * 100;


                <td style="text-align: right; ">  @(total_ideass == 0 ? "0" : String.Format("{0:.#}", percentage))% </td>
                <td></td>
                        }

                    </tr>
                    <tr>
                        <td> Number of Contributors(Ideas) within each department </td>
                        @{

                            List<idea> id = dbData.ideas.ToList();

                            int contributors = id.Where(i => i.user.user_id == dept.department_id).Distinct().Count();

                        <td style="text-align: right; "> @(contributors == 0 ? "0" : String.Format("{0:.#}", contributors))</td>
                        <td></td>
                        }
                    </tr>

                    <tr>
                        <td> Number of Contributors(Comments) within each department </td>
                        @{

                                 List<comment> cmt = dbData.comments.ToList();

                                 int contributors2 = cmt.Where(c => c.user.user_id == dept.department_id).Distinct().Count();

                         <td style="text-align: right; "> @(contributors2 == 0 ? "0" : String.Format("{0:.#}", contributors2))</td>
                        <td></td>
                        }
                    </tr>
                </table>

                <hr>
                <hr>
            
            <br><br>
            <hr><hr>
        </div>


                            }
    </div>


    <div class="row">
        <div class="col-md-3"></div>
        <div class="form-group col-md-6">
            <button onclick="show()" class="btn btn-primary form-control" id="SystemChartButton" data-toggle="modal" data-target="#myModal">
                View System Chart
            </button>
        </div>
    </div>

</div>

<div class="" id="systemcharts">
    <div class="row">
        <div class="col-lg-6">
            <img src='@Url.Action("NumberOfIdeascharts",new { type = "column" })' />
        </div>
        <div class="col-lg-6">
            <img src='@Url.Action("PercentageOfIdeasByDepartment",new { type = "Doughnut" })' />
        </div>
    </div>
    <div class="row">
        <div class="col-lg-3"></div>
        <div class="col-lg-6">
            <img src='@Url.Action("NumberOfContributorsPerDepartment",new { type = "column" })'  />
        </div>

    </div>
</div>


<script type="text/javascript">
    var i = 1;
    document.getElementById("systemcharts").style.display = 'none';
    function show() {
        if (i == 0) {
            document.getElementById("systemcharts").style.display = 'block';
            document.getElementById("SystemChartButton").innerText = "Hide System Chart";
            i = 1;
        }
        else {
            document.getElementById("systemcharts").style.display = 'none';
            document.getElementById("SystemChartButton").innerText = "View System Chart";
            i = 0;
        }
    }
</script>